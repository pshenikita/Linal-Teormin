\section{Жорданова нормальная форма}

Наша глобальная цель --- научиться приводить матрицы к <<хорошему>> виду. Некоторые операторы можно диагонализировать, но не все. Ясно, что для этого необходимо и достаточно уметь выбирать базис из собственных векторов. Существование такого базиса равносильно выполнению следующих двух условий:

\begin{enumerate}[nolistsep, label=(\arabic*)]
	\item характеристический многочлен оператора разлагается на линейные множители;
	\item кратность каждого корня характериского многочлена равна размерности соответствующего собственного подпространства.
\end{enumerate}

От первого условия мы никуда не уйдём, а вот от второго условия сможем отказаться. При этом для выбора <<хорошего>> базиса нам потенциально может не хватить собственных векторов, поэтому естественно рассмотреть какое-то обобщение этого понятия.

\begin{definition}
	Вектор $\vec{v} \in V$ называется \textit{корневым} вектором линейного оператора $\A$, отвечающим числу $\lambda \in \Bbbk$, если
	\[
		(\A - \lambda\id)^m\vec{v} = \vec{0}
	\]
	для некоторого целого неотрицательного числа $m$. Наименьшее из таких чисел называется \textit{высотой} корневого вектора $\vec{v}$.
\end{definition}

Легко видеть, что ненулевые корневые векторы могут отвечать только собственным числам оператора, а также что корневые векторы, соответствующие фиксированному числу $\lambda \in \Bbbk$, образуют подпространство, оно называется \textit{корневым}.

Оказывается, что если характеристический многочлен оператора разлагается на линейные множители, то пространство разлагается в сумму корневых подпространств этого оператора, поэтому нам достаточно выбрать <<хорошие>> базисы для таких подпространств. Нетрудно видеть, что ограничение $(\A - \lambda\id)\big|_{R_\lambda}$ является нильпотентным оператором, а для нильпотентных операторов можно доказать следующую теорему.

\begin{theorem} \label{theorem:NilpotentNormalForm}
	Для каждого нильпотентного оператора $\mathcal{N}$ можно выбрать базис, в котором его матрица блочно-диагональна с блоками вида
	\begin{equation} \label{eq:NilpotentBlock}
		\begin{pmatrix}
			0 & & & 0 \\
			1 & 0 & & \\
			 & \ddots & \ddots & \\
			0 & & 1 & 0
		\end{pmatrix},
	\end{equation}
	причём такой вид оператора единственен с точностью до перестановки блоков.
\end{theorem}

Действие оператора, заданного в некотором базисе $\vec{e}_1, \ldots, \vec{e}_m$ матрицей \eqref{eq:NilpotentBlock}, описывается схемой\footnotemark{} $\vec{e}_1 \mapsto \vec{e}_2 \mapsto \ldots \mapsto \vec{e}_m \mapsto \vec{0}$. Построив указанный в теореме \ref{theorem:NilpotentNormalForm} базис в каждом из корневых подпространств, получим следующее утверждение.

\footnotetext{Здесь мы (вслед за Антоном Александровичем) намеренно изображаем жордановы клетки <<перевёрнутыми>>, нам так будет удобнее. Мы хотим, чтобы первый базисный вектор $\vec{e}_1$ имел максимальную высоту.}

\begin{theorem} \label{theorem:JordanNormalForm}
	Для каждого линейного оператора, характеристический многочлен которого разлагается на линейные множители, можно выбрать базис, в котором его матрица блочно-диагональна с блоками вида
	\begin{equation} \label{eq:JordanBlock}
		J_\lambda =
		\begin{pmatrix}
			\lambda & & & 0 \\
			1 & \lambda & & \\
			 & \ddots & \ddots & \\
			0 & & 1 & \lambda
		\end{pmatrix},
	\end{equation}
	причём такой вид оператора единственен с точностью до перестановки блоков.
\end{theorem}

\begin{definition}
	Вид оператора, указанный в теореме \ref{theorem:JordanNormalForm}, называется \textit{жордановой нормальной формой} оператора, а блоки вида \eqref{eq:JordanBlock} --- \textit{жордановыми клетками}. Базис, в котором оператор имеет интересующий нас вид, также называется \textit{жордановым}.
\end{definition}

Чтобы найти жорданову форму оператора $\A$, сначала находим характеристический многочлен $\chi_\A(t)$ и выписываем его корни $\lambda_1, \ldots, \lambda_r$ и их кратности $k_1, \ldots, k_r$. На диагонали в жордановой форме стоят собственные значения:

\vspace{5mm}
\[
	J =
	\begin{pNiceMatrix}[parallelize-diags = false]
		\lambda_1 & & & & & & & \\
		& \Ddots & & & & & & \\
		& & \lambda_1 & & & & & \\
		& & & \Ddots & & & & \\
		& & & & & & & \\
		& & & & & \lambda_r & & \\
		& & & & & & \Ddots & \\
		& & & & & & & \lambda_r
		\CodeAfter
			\OverBrace[shorten, yshift=1.5mm]{1-1}{1-3}{k_1}
			\OverBrace[shorten, yshift=1.5mm]{1-6}{1-8}{k_r}
	\end{pNiceMatrix}
\]

Осталось понять, как эти собственные значения распределены по жордановым клеткам (ведь может быть и несколько клеток с одним собственным значением). Для начала отметим важный момент. Если $A$ --- матрица оператора в некотором базисе, а $J$ --- жорданова матрица, то существует матрица $C$ замены базиса такая, что $A = C^{-1}JC$. При этом
\[
	\rk(A - \lambda E) = \rk\big(C^{-1}(A - \lambda E)C\big) = \rk\big(\underbrace{C^{-1}AC}_{J} - \lambda\underbrace{C^{-1}C}_{E}\big) = \rk(J - \lambda E).
\]
для любого $\lambda$. (Первое равенство --- это просто равенство рангов подобных матриц.)

\begin{lemma}
	Количество жордановых клеток с собственным значением $\lambda$ размера не меньше $k$ равняется
	\[
		\rk(A - \lambda E)^{k - 1} - \rk(A - \lambda E)^k.
	\]
\end{lemma}

\begin{proof}
	Пусть $\lambda$ --- единственное собственное значение матрицы $A$. Как мы уже заметили выше, $\rk(A - \lambda E) = \rk(J - \lambda E)$, поэтому можем доказывать то же самое, заменив $A$ на $J$. Рассмотрим часть жордановой матрицы, соответствующей собственному значению $\lambda$. При переходе от матрицы $(J - \lambda E)^{k - 1}$ к $(J - \lambda E)^k$ из всех жордановых клетки, кроме тех, которые уже целиком обнулились, исчезает по единице. В матрице $(J - \lambda E)^{k - 1}$ целиком обнулились клетки размером меньше $k$, поэтому искомая разность есть количество клеток размера не меньше $k$.

	Осталось доказать, почему клетки с другими собственными значениями не влияют на ранг. Иными словами, нужно доказать, что для клетки $J_\lambda$ с $\lambda \ne 0$ размера $m \times m$ и для любого $l \in \N$ имеет место равенство $\rk J_\lambda^l = m$. Это сразу следует из предложения $2{.}11{.}1$ из \cite{P24}: для любого многочлена $f$ его значение на жордановой клетке есть
	\[
		f(J_\lambda) =
		\begin{pmatrix}
			f(\lambda) & & & 0\\
			\frac{f^\prime(\lambda)}{1!} & f(\lambda) & & \\
			\vdots & \ddots & \ddots & \\
			\frac{f^{(n - 1)}(\lambda)}{(n - 1)!} & \ldots & \frac{f^\prime(\lambda)}{1!} & f(\lambda)
		\end{pmatrix}
	\]

	Нас интересуют многочлены вида $f(t) = t^l$. Если $\lambda \ne 0$, то $f(\lambda) = \lambda^l \ne 0$ (в поле нет делителей нуля). Тогда матрица $J_\lambda^l$ треугольная, с ненулевыми числами на диагонали, значит, её ранг равен её размеру. Осталось упомянуть, что многочлен от блочной матрицы (нас интересует жорданова форма оператора) применяется к ней поблочно. Отсюда и следует желаемое.
\end{proof}

С помощью этой леммы, для каждого $k$ находим количество жордановых клеток размера $k$ как количество клеток размера не меньше $k$ за вычетом клеток размера не меньше $k + 1$. Повторить для каждого собственного значения.

\begin{problem}
	Найти жорданову форму для оператора $\A$, матрица которого в стандартном базисе имеет вид
	\[
		A =
		\begin{pmatrix}
			2 & 0 & 1 & 2 & 3\\
			0 & 2 & 0 & 1 & 2\\
			0 & 0 & 2 & 0 & 1\\
			0 & 0 & 0 & 2 & 0\\
			0 & 0 & 0 & 0 & 2
		\end{pmatrix}.
	\]
\end{problem}

\begin{solution}
	Характеристический многочлен имеет вид $\chi_\A(t) = (2 - t)^5$, отсюда имеем единственный корень $2$ кратности $5$. Так что жорданова матрица выглядит так:
	\[
		\begin{pmatrix}
			2 & 0 & 0 & 0 & 0\\
			\ast & 2 & 0 & 0 & 0\\
			0 & \ast & 2 & 0 & 0\\
			0 & 0 & \ast & 2 & 0\\
			0 & 0 & 0 & \ast & 2
		\end{pmatrix}
	\]

	Чтобы понять распределение собственных значений по клеткам, находим ранги матриц $(A - 2E)^k$, где $k = 1, \ldots, 5$:
	\begin{gather*}
		\rk(A - 2E) = \rk
		\begin{pmatrix}
			0 & 0 & 1 & 2 & 3\\
			0 & 0 & 0 & 1 & 2\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix} = 3,\qquad
		\begin{pmatrix}
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix} = 1,\\
		\rk(A - 2E)^3 = \rk(A - 2E)^4 = \rk(A - 2E)^5 = 0.
	\end{gather*}

	Получаем, что клеток размера хотя бы $1$ (то есть, всего клеток) ровно $5 - 3 = 2$, хотя бы $2$ --- ровно $3 - 1 = 2$, хотя бы $3$ --- ровно $1 - 0 = 1$, клеток больших размеров нет. Таким образом, имеем одну клетку $3 \times 3$ и одну клетку размера $2 \times 2$, и жорданова форма данной матрицы имеет вид
	\[
		\begin{pmatrix}
			2 & 0 & 0 & 0 & 0\\
			1 & 2 & 0 & 0 & 0\\
			0 & 1 & 2 & 0 & 0\\
			0 & 0 & 0 & 2 & 0\\
			0 & 0 & 0 & 1 & 2
		\end{pmatrix}.
	\]
\end{solution}

Теперь научимся находить жорданов базис. Метод, который здесь изложен, описан в файле Антона Александровича \cite{Klyachko}. Здесь к нему даны дополнительные пояснения и необходимые теоретические обоснования.

Напомним, что по сути то, чем мы занимаемся, --- это выбор базиса для нильпотентного оператора $\mathcal{N}$, в котором он имеет вид, указанный в теореме \ref{theorem:NilpotentNormalForm}.

\begin{lemma}
	Если вектор $\vec{v}$ максимальной высоты $m$ для нильпотентного оператора $\mathcal{N}$, то векторы $\vec{v},\,\mathcal{N}\vec{v},\,\mathcal{N}^2\vec{v},\,\ldots,\,\mathcal{N}^{m - 1}\vec{v}$ линейно независимы.
\end{lemma}

\begin{proof}
	Напишем какую-то нетривиальную линейную комбинацию данных векторов с коэффициентами $\lambda_0, \ldots, \lambda_{m - 1}$
	\[
		\lambda_0\vec{v} + \lambda_1\mathcal{N}\vec{v} + \ldots + \lambda_{m - 1}\mathcal{N}^{m - 1}\vec{v},
	\]
	и пусть $k$ --- номер первого ненулевого коэффициента, т.\,е. можно записывать эту линейную комбинацию, начиная с члена под номером $k$. Тогда
	\[
		\mathcal{N}^{m - k - 1}\br{\lambda_k\mathcal{N}^k\vec{v} + \ldots + \lambda_{m - 1}\mathcal{N}^{m - 1}\vec{v}} = \mathcal{N}^{m - 1}\vec{v} \ne \vec{0},
	\]
	а нулевой вектор всегда переходит в нулевой под действием линейного оператора.
\end{proof}

Таким образом, если мы хотим выбрать базис подпространства, соответствующего некоторой жордановой клетке $J_\lambda$ размера $m \times m$, то нам достаточно выбрать вектор высоты $m$ для нильпотентного оператора $\A - \lambda\id$. Для простоты изложения, здесь мы разберём несколько случаев --- от простого к сложному.

\medskip
\noindent{\large\bfseries \rnum{1}. В жордановой форме только одна клетка}
\smallskip

\[
	J =
	\begin{pNiceMatrix}
		\lambda & & & 0 \\
		1 & \lambda & & \\
		 & \ddots & \ddots & \\
		0 & & 1 & \lambda
		\CodeAfter
			\UnderBrace[yshift=2mm]{4-1}{4-4}{m}
			\SubMatrix{.}{1-1}{4-4}{\}}[xshift=2mm]
	\end{pNiceMatrix}\hspace{2.5mm}m
\]
\vspace{5mm}

В этом случае всё пространство есть корневое для собственного значения $\lambda$, и нам нужно выбрать из него вектор высоты $m$, а потом $m - 1$ раз применить к нему оператор $\A - \lambda\id$.

Утверждается, что можно взять просто \underline{случайный} вектор (да, какой первый в голову придёт). Действительно, всё что нам нужно от этого вектора --- чтобы он не лежал в ядре $\Ker(\A - \lambda\id)^{m - 1}$ (то есть его высота должна равняться $m$). А это ядро является подпространством, и вероятность (в любом разумном смысле этого слова), что случайный вектор попадёт в это подпространство, мала. Конечно, нам может не повезти, но тогда мы это заметим --- применяя оператор $\A - \lambda\id$ к нашему вектору, мы получим нулевой вектор раньше, чем того хотели. В этом случае нужно просто вернуться назад и выбрать другой случайный вектор.

\begin{problem}
	Найти жорданову форму и жорданов базис оператора $\A$, матрица которого в стандартном базисе имеет вид
	\[
		A = \begin{pmatrix}
			3 & 2 & 2 & 2\\
			0 & 3 & 1 & 1\\
			0 & 0 & 3 & 1\\
			0 & 0 & 0 & 3
		\end{pmatrix}.
	\]
\end{problem}

\begin{solution}
	Имеем одно собственное значение $3$ кратности $4$. Найдём жорданову форму:
	\begin{gather*}
		\rk(A - 3E) = \rk
		\begin{pmatrix}
			0 & 2 & 2 & 2\\
			0 & 0 & 1 & 1\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0
		\end{pmatrix} = 3,
	\end{gather*}
	и на этом можно закончить, потому что уже сейчас видно, что жорданова клетка только одна (жордановых клеток размера не меньше $1$ ровно $4 - 3 = 1$). Итак, жорданова форма имеет вид
	\[
		J =
		\begin{pmatrix}
			3 & 0 & 0 & 0\\
			1 & 3 & 0 & 0\\
			0 & 1 & 3 & 0\\
			0 & 0 & 1 & 3
		\end{pmatrix}.
	\]

	Приступим к нахождению жорданова базиса. В качестве случайного вектора возьмём, например,
	\[
		\vec{e}^\prime_1 =
		\begin{pmatrix}
			1\\
			1\\
			0\\
			0
		\end{pmatrix}.
	\]
	Находим остальные векторы:
	\[
		\vec{e}^\prime_2 = (A - 3E)\vec{e}^\prime_1 = 
		\begin{pmatrix}
			0 & 2 & 2 & 2\\
			0 & 0 & 1 & 1\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			1\\
			1\\
			0\\
			0
		\end{pmatrix} =
		\begin{pmatrix}
			2\\
			0\\
			0\\
			0
		\end{pmatrix},\qquad
		\vec{e}^\prime_3 = (A - 3E)\vec{e}^\prime_2 = \vec{0}.
	\]

	Итак, мы получили нулевой вектор, значит, выбранный нами случайный вектор $\vec{e}_1^\prime$ не подходит. Ничего страшного, берём новый:
	\[
		\vec{e}^\prime_1 =
		\begin{pmatrix}
			4\\
			3\\
			2\\
			1
		\end{pmatrix}.
	\]
	Опять пытаемся найти остальные векторы:
	\begin{gather*}
		\vec{e}^\prime_2 = (A - 3E)\vec{e}^\prime_1 = 
		\begin{pmatrix}
			0 & 2 & 2 & 2\\
			0 & 0 & 1 & 1\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			4\\
			3\\
			2\\
			1
		\end{pmatrix} =
		\begin{pmatrix}
			12\\
			3\\
			1\\
			0
		\end{pmatrix},\\
		\vec{e}^\prime_3 = (A - 3E)\vec{e}^\prime_2 = 
		\begin{pmatrix}
			0 & 2 & 2 & 2\\
			0 & 0 & 1 & 1\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			12\\
			3\\
			1\\
			0
		\end{pmatrix} =
		\begin{pmatrix}
			8\\
			1\\
			0\\
			0
		\end{pmatrix},\\
		\vec{e}^\prime_4 = (A - 3E)\vec{e}^\prime_3 = 
		\begin{pmatrix}
			0 & 2 & 2 & 2\\
			0 & 0 & 1 & 1\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			8\\
			1\\
			0\\
			0
		\end{pmatrix} =
		\begin{pmatrix}
			2\\
			0\\
			0\\
			0
		\end{pmatrix}.
	\end{gather*}
	На этот раз\footnotemark{} вектор подошёл, и мы нашли базис целиком.
\end{solution}

\footnotetext{Если выбирать вектор на самом деле случайно, то не везёт очень редко, особенно над бесконечными полями. В решении задачи первый вектор был намеренно выбран плохим.}

\medskip
\noindent{\large\bfseries \rnum{2}. В жордановой форме несколько клеток одного размера}
\smallskip

Теперь нужно повторить процесс из предыдущего пункта несколько раз (по разу для каждой клетки) и потом проверить линейную независимость полученных векторов. Мы утверждаем, что достаточно проверять линейную независимость только собственных векторов. Мы докажем это для базисов, соответствующих двум жордановым клеткам, но доказательство в общем случае проводится аналогично.

\begin{lemma}
	Имеется вектор $\vec{v}$ высоты $m$ и вектор $\vec{u}$ высоты $k$ для нильпотентного оператора $\mathcal{N}$. Система векторов $\vec{v},\,\mathcal{N}\vec{v},\,\ldots,\,\mathcal{N}^{m - 1}\vec{v},\,\vec{u},\,\mathcal{N}\vec{u},\,\ldots,\,\mathcal{N}^{k - 1}\vec{u}$ линейно независима тогда и только тогда, когда линейно независимы собственные векторы $\mathcal{N}^{m - 1}\vec{v}$ и $\mathcal{N}^{k - 1}\vec{u}$.
\end{lemma}

\begin{proof}
	Напишем линейную комбинацию данной системы с произвольными коэффициентами, отвечающую нулевому вектору:
	\[
		\lambda_0\vec{v} + \lambda_1\mathcal{N}\vec{v} + \ldots + \lambda_{m - 1}\mathcal{N}^{m - 1}\vec{v} + \mu_0\vec{u} + \mu_1\mathcal{N}\vec{u} + \ldots + \mu_{k - 1}\mathcal{N}^{k - 1}\vec{u} = \vec{0}
	\]
	и будем доказывать, что она тривиальна.

	Сначала предположим, что $m$ и $k$ различны, тогда без ограничения общности $m > k$. Возьмём от обеих частей оператор $\mathcal{N}^{m - 1}$, останется $\lambda_0\mathcal{N}^{m - 1}\vec{v} = \vec{0}$, отсюда $\lambda_0 = 0$ (ведь $\mathcal{N}^{m - 1}\vec{v} \ne \vec{0}$ из условия на высоту вектора $\vec{v}$). Аналогично доказывается, что $\lambda_0 = \ldots \hm= \lambda_{m - k - 1} = 0$. После этого можем перенумеровать коэффициенты $\lambda_i \leadsto \lambda_{i - m + k}$ для $i \hm\geqslant k - m$ (про нулевые коэффициенты забываем) и заменить вектор $\vec{v} \leadsto \mathcal{N}^{m - k}\vec{v}$.

	Итак, можем считать, что $m = k$. Тогда наша линейная комбинация принимает вид
	\[
		\lambda_0\vec{v} + \lambda_1\mathcal{N}\vec{v} + \ldots + \lambda_{m - 1}\mathcal{N}^{m - 1}\vec{v} + \mu_0\vec{u} + \mu_1\mathcal{N}\vec{u} + \ldots + \mu_{m - 1}\mathcal{N}^{m - 1}\vec{u} = \vec{0}.
	\]

	Возьмём оператор $\mathcal{N}^{m - 1}$ от обеих частей, получим $\lambda_0\mathcal{N}^{m - 1}\vec{v} + \mu_0\mathcal{N}^{m - 1}\vec{u} = \vec{0}$. Про векторы $\mathcal{N}^{m - 1}\vec{v}$ и $\mathcal{N}^{m - 1}\vec{u}$ мы знаем, что они линейно независимы, поэтому $\lambda_0 = \mu_0 = 0$. Теперь берём оператор $\mathcal{N}^{m - 2}$ от обеих частей и так же получаем $\lambda_1 = \mu_1 = 0$. Так же доказываем, что все коэффициенты линейной зависимости нулевые, то есть она тривиальна.
\end{proof}

Таким образом, когда мы нашли куски жорданова базиса, соответствующие разным клеткам, нам достаточно проверить линейную независимость последних (собственных) векторов каждого куска.

\begin{problem}
	Найти жорданову форму и жорданов базис оператора $\A$, матрица которого в стандартном базисе имеет вид
	\[
		A =
		\begin{pmatrix}
			3 & 0 & 2 & 2\\
			0 & 3 & 0 & 1\\
			0 & 0 & 3 & 0\\
			0 & 0 & 0 & 3
		\end{pmatrix}.
	\]
\end{problem}

\begin{solution}
	Здесь опять одно собственное значение кратности $4$. Находим жорданову форму, как обычно:
	\begin{gather*}
		\rk(A - 3E) = \rk
		\begin{pmatrix}
			0 & 0 & 2 & 2\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0
		\end{pmatrix} = 2,\qquad \rk(A - 3E)^2 = 0
	\end{gather*}

	Таким образом, у нас $2 - 0 = 2$ клетки размера хотя бы $2$, отсюда сразу можно сделать вывод, что имеется ровно две клетки размера $2 \times 2$, то есть жорданова форма имеет вид
	\[
		J =
		\begin{pmatrix}
			3 & 0 & 0 & 0\\
			1 & 3 & 0 & 0\\
			0 & 0 & 3 & 0\\
			0 & 0 & 1 & 3
		\end{pmatrix}.
	\]
	Выбираем случайный вектор и находим оставшийся кусок базиса для первой клетки:
	\[
		\vec{e}^\prime_1 =
		\begin{pmatrix}
			1\\
			1\\
			1\\
			1
		\end{pmatrix},\qquad
		\vec{e}^\prime_2 = (A - 3E)\vec{e}^\prime_1 =
		\begin{pmatrix}
			0 & 0 & 2 & 2\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			1\\
			1\\
			1\\
			1
		\end{pmatrix} =
		\begin{pmatrix}
			4\\
			1\\
			0\\
			0
		\end{pmatrix}.
	\]
	Теперь то же самое для второй:
	\[
		\vec{e}^\prime_3 =
		\begin{pmatrix}
			0\\
			0\\
			1\\
			2
		\end{pmatrix},\qquad
		\vec{e}^\prime_4 = (A - 3E)\vec{e}^\prime_3 =
		\begin{pmatrix}
			0 & 0 & 2 & 2\\
			0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			0\\
			0\\
			1\\
			2
		\end{pmatrix} =
		\begin{pmatrix}
			6\\
			2\\
			0\\
			0
		\end{pmatrix}.
	\]

	Собственные векторы $\vec{e}^\prime_2$ и $\vec{e}^\prime_4$, очевидно, линейно независимы, так что построенная нами система действительно является жордановым базисом для данного оператора.
\end{solution}

\medskip
\noindent{\large\bfseries \rnum{3}. Есть клетки разных размеров с одним собственным значением}
\smallskip

Упорядочим клетки по размерам: $m_1 > m_2 > \ldots > m_l$. Для самой большой клетки (размера $m_1$) делаем всё, как обычно. Для меньшей клетки размера $m_2$ нужно найти вектор высоты $m_2$ для оператора $\A - \lambda\id$, но который не выражается через вектор высоты $m_2 \hm< m_1$, который получился в процессе выбора базиса для предыдущей клетки. Для этого нам придётся выписать решения системы линейных уравнений
\[
	(A - \lambda E)^{m_2}X = \vec{0}
\]
и выбрать среди них вектор, линейно независимый с векторами высоты, меньшей $m_2$, из уже полученного куска базиса. Для этого можно, опять же, взять \underline{случайный} вектор из подпространства решений этой системы (по тем же причинам, что и раньше).

Так повторяем для всех клеток, а потом обязательно проверяем линейную независимость полученных собственных векторов. Здесь, опять же, если нам где-то не повезло с выбором случайного вектора, мы это обязательно заметим --- вектора в конце получатся линейно зависимыми.

\begin{problem}
	Найти жорданову форму и жорданов базис оператора $\A$, матрица которого в стандартном базисе имеет вид
	\[
		A =
		\begin{pmatrix}
			2 & 0 & 3 & 4 & 1\\
			0 & 2 & 0 & 5 & 1\\
			0 & 0 & 2 & 0 & 1\\
			0 & 0 & 0 & 2 & 0\\
			0 & 0 & 0 & 0 & 2
		\end{pmatrix}.
	\]
\end{problem}

\begin{solution}
	Имеем одно собственное значение $2$ кратности $5$. Находим жорданову форму:
	\begin{gather*}
		\rk(A - 2E) = \rk
		\begin{pmatrix}
			0 & 0 & 3 & 4 & 1\\
			0 & 0 & 0 & 5 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix} = 3,\qquad
		\rk(A - 2E)^2 = \rk
		\begin{pmatrix}
			0 & 0 & 0 & 0 & 3\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix} = 1,\\
		\rk(A - 2E)^3 = 0.
	\end{gather*}

	Имеем $5 - 3 = 2$ клетки, причём обе размера хотя бы $2$ ($3 - 1 = 2$), но только одна размера хотя бы $3$ ($1 - 0 = 1$), отсюда делаем вывод, что жорданова форма имеет вид
	\[
		J =
		\begin{pmatrix}
			2 & 0 & 0 & 0 & 0\\
			1 & 2 & 0 & 0 & 0\\
			0 & 1 & 2 & 0 & 0\\
			0 & 0 & 0 & 2 & 0\\
			0 & 0 & 0 & 1 & 2
		\end{pmatrix}.
	\]
	Для клетки $3 \times 3$ делаем всё, как обычно:
	\[
		\vec{e}^\prime_1 =
		\begin{pmatrix}
			0\\
			0\\
			1\\
			1\\
			1
		\end{pmatrix},\qquad
		\vec{e}^\prime_2 = (A - 2E)\vec{e}^\prime_1 =
		\begin{pmatrix}
			0 & 0 & 3 & 4 & 1\\
			0 & 0 & 0 & 5 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			0\\
			0\\
			1\\
			1\\
			1
		\end{pmatrix} =
		\begin{pmatrix}
			8\\
			6\\
			1\\
			0\\
			0
		\end{pmatrix},
	\]
	\[
		\vec{e}^\prime_3 = (A - 2E)\vec{e}^\prime_2 =
		\begin{pmatrix}
			0 & 0 & 3 & 4 & 1\\
			0 & 0 & 0 & 5 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			8\\
			6\\
			1\\
			0\\
			0
		\end{pmatrix} =
		\begin{pmatrix}
			1\\
			0\\
			0\\
			0\\
			0
		\end{pmatrix}.
	\]
	У нас ещё осталась клетка $2 \times 2$. Для неё решаем линейную систему:
	\begin{gather*}
		(A - 2E)^2X = \vec{0},\qquad
		\begin{pmatrix}
			0 & 0 & 0 & 0 & 3\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix} \cdot X =
		\begin{pmatrix}
			0\\
			0\\
			0\\
			0\\
			0
		\end{pmatrix}.
	\end{gather*}

	В качестве $\vec{e}^\prime_4$ можно взять любое решение этой системы (то есть, любой вектор с пятой координатой, равной $0$), например,
	\[
		\vec{e}^\prime_4 =
		\begin{pmatrix}
			1\\
			1\\
			1\\
			1\\
			0
		\end{pmatrix},\qquad
		\vec{e}^\prime_5 = (A - 2E)\vec{e}^\prime_4 =
		\begin{pmatrix}
			0 & 0 & 3 & 4 & 1\\
			0 & 0 & 0 & 5 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			1\\
			1\\
			1\\
			1\\
			0
		\end{pmatrix} =
		\begin{pmatrix}
			7\\
			5\\
			0\\
			0\\
			0
		\end{pmatrix}.
	\]

	Векторы $\vec{e}^\prime_3$ и $\vec{e}^\prime_5$, очевидно, линейно независимы, так что векторы $\vec{e}^\prime_1$, $\vec{e}^\prime_2$, $\vec{e}^\prime_3$, $\vec{e}^\prime_4$, $\vec{e}^\prime_5$ действительно образуют жорданов базис.
\end{solution}

\medskip
\noindent{\large\bfseries \rnum{4}. Есть клетки с разными собственными значениями}
\smallskip

Здесь мы, наконец, рассматриваем максимально общий случай. В этом месте возникает важный момент --- теперь всё пространство не является корневым для определённого собственного значения. Как же нам теперь найти случайный \underline{корневой} вектор?

Пусть нас интересует собственное значение $\lambda$. Сначала выберем какой-то аннулирующий многочлен $f$ для оператора $\A$ (например, минимальный многочлен $\mu_\A$) и какой-то случайный вектор $\vec{v}$. А теперь подействуем на наш случайный вектор оператором
\[
	\left.\frac{f(t)}{(t - \lambda)^k}\right|_\A,
\]
где $k$ --- кратность $\lambda$ как корня многочлена $f$. Таким образом мы получим желаемый случайный корневой вектор $\vec{u}$, отвечающий собственному значению $\lambda$. Действительно,
\[
	(\A - \lambda\id)^k\vec{u} = \left.(t - \lambda)^k\right|_\A\left.\frac{f(t)}{(t - \lambda)^k}\right|_\A\vec{v} = f(\A)\vec{v} = \vec{0},
\]
так как многочлен $f$ является аннулирующим для оператора $\A$. Для нахождения минимального многочлена можно воспользоваться стандартным утверждением.

\begin{proposition}
	Если характеристический многочлен оператора $\A$ раскладывается на линейные множители, то минимальный аннулирующий многочлен этого оператора есть
	\[
		\prod_{i = 1}^r(t - \lambda_i)^{m_i},
	\]
	где $\lambda_1, \ldots, \lambda_r$ --- все собственные значения оператора $\A$, а $m_i$ --- размер максимальной жордановой клетки, отвечающей собственному значению $\lambda_i$.
\end{proposition}

\begin{problem}
	Найти жорданову форму и жорданов базис оператора $\A$, матрица которого в стандартном базисе имеет вид
	\[
		A =
		\begin{pmatrix}
			2 & 0 & 3 & 4 & 1\\
			0 & 2 & 0 & 5 & 1\\
			0 & 0 & 2 & 0 & 1\\
			0 & 0 & 0 & 2 & 0\\
			0 & 0 & 0 & 0 & 3
		\end{pmatrix}.
	\]
\end{problem}

\begin{solution}
	Находим жорданову форму. На этот раз мы имеем одно собственное значение $2$ кратности $4$ и другое --- $3$ кратности $1$. Но с тройкой, конечно, всё понятно --- там точно одна жорданова клетка $1 \times 1$. Разбираемся с двойкой.
	\begin{gather*}
		\rk(A - 2E) = \rk
		\begin{pmatrix}
			0 & 0 & 3 & 4 & 1\\
			0 & 0 & 0 & 5 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 1
		\end{pmatrix} = 3,\qquad
		\rk(A - 2E)^k = \rk
		\begin{pmatrix}
			0 & 0 & 0 & 0 & 4\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 1
		\end{pmatrix} = 1
	\end{gather*}
	для всех $k \geqslant 2$. Таким образом, жордановых клеток с собственным значением $\lambda$ ровно $5 - 3 = 2$, клеток размера хотя бы $2$ ровно $3 - 1 = 2$, а других клеток нет. Таким образом, жорданова форма имеет вид
	\[
		J =
		\begin{pmatrix}
			2 & 0 & 0 & 0 & 0\\
			1 & 2 & 0 & 0 & 0\\
			0 & 0 & 2 & 0 & 0\\
			0 & 0 & 1 & 2 & 0\\
			0 & 0 & 0 & 0 & 3
		\end{pmatrix}.
	\]

	Найдём случайный корневой, соответствующий собственному значению $2$. Минимальный многочлен имеет вид $\mu_\A(t) = (t - 2)^2(t - 3)$. Выбираем случайный вектор
	\[
		\vec{v} =
		\begin{pmatrix}
			1\\
			1\\
			1\\
			1\\
			1
		\end{pmatrix}
	\]
	и действуем на него оператором $\left.\br{\mu_\A(t) / (t - 2)^2}\right|_\A = \left.(t - 3)\right|_\A = \A - 3\id$:
	\[
		\vec{e}^\prime_1 = (A - 3E)\vec{v} =
		\begin{pmatrix}
			-1 & 0 & 3 & 4 & 1\\
			0 & -1 & 0 & 5 & 1\\
			0 & 0 & -1 & 0 & 1\\
			0 & 0 & 0 & -1 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			1\\
			1\\
			1\\
			1\\
			1
		\end{pmatrix} =
		\begin{pmatrix}
			7\\
			5\\
			0\\
			-1\\
			0
		\end{pmatrix}.
	\]

	Получаем случайный корневой вектор, соответствующий собственному значению $\lambda$, который и назовём первым базисным вектором. Находим второй:
	\[
		\vec{e}^\prime_2 = (A - 2E)\vec{e}^\prime_1 =
		\begin{pmatrix}
			0 & 0 & 3 & 4 & 1\\
			0 & 0 & 0 & 5 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 1
		\end{pmatrix}
		\begin{pmatrix}
			7\\
			5\\
			0\\
			-1\\
			0
		\end{pmatrix} =
		\begin{pmatrix}
			-4\\
			-5\\
			0\\
			0\\
			0
		\end{pmatrix}.
	\]

	Теперь разбираемся со второй клеткой, отвечающей собственному значению $2$. Она того же размера, что и первая, поэтому никаких систем решать не нужно. Достаточно выбрать другой случайный вектор
	\[
		\vec{u} =
		\begin{pmatrix}
			5\\
			4\\
			3\\
			2\\
			1
		\end{pmatrix}
	\]
	и подействовать на него тем же оператором:
	\[
		\vec{e}^\prime_3 = (A - 3E)\vec{u} =
		\begin{pmatrix}
			-1 & 0 & 3 & 4 & 1\\
			0 & -1 & 0 & 5 & 1\\
			0 & 0 & -1 & 0 & 1\\
			0 & 0 & 0 & -1 & 0\\
			0 & 0 & 0 & 0 & 0
		\end{pmatrix}
		\begin{pmatrix}
			5\\
			4\\
			3\\
			2\\
			1
		\end{pmatrix} =
		\begin{pmatrix}
			13\\
			7\\
			-2\\
			-2\\
			0
		\end{pmatrix}.
	\]
	После чего находим второй вектор базиса подпространства, соответствующего этой клетке:
	\[
		\vec{e}^\prime_4 = (A - 2E)\vec{e}^\prime_3 =
		\begin{pmatrix}
			0 & 0 & 3 & 4 & 1\\
			0 & 0 & 0 & 5 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 1
		\end{pmatrix}
		\begin{pmatrix}
			13\\
			7\\
			-2\\
			-2\\
			0
		\end{pmatrix} =
		\begin{pmatrix}
			-14\\
			-10\\
			0\\
			0\\
			0
		\end{pmatrix}.
	\]

	Векторы $\vec{e}^\prime_2$ и $\vec{e}^\prime_4$, очевидно, линейно независимы. Осталось найти единственный собственный вектор для значения собственного $3$, так же, как мы искали корневые векторы для двойки. Только теперь случайный вектор можно взять $\vec{v}$ или $\vec{u}$, который мы уже брали раньше, потому что теперь мы работаем с другим собственным значением.
	\[
		\vec{e}^\prime_5 = (A - 2E)^2\vec{v} =
		\begin{pmatrix}
			0 & 0 & 0 & 0 & 4\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 1\\
			0 & 0 & 0 & 0 & 0\\
			0 & 0 & 0 & 0 & 1
		\end{pmatrix}
		\begin{pmatrix}
			1\\
			1\\
			1\\
			1\\
			1
		\end{pmatrix} =
		\begin{pmatrix}
			4\\
			1\\
			1\\
			0\\
			1
		\end{pmatrix}.
	\]

	Линейную независимость $\vec{e}^\prime_5$ ни с кем проверять уже не надо, он лежит в своём корневом подпространстве (вспомнить теорему о разложении пространства в прямую сумму корневых подпространств).
\end{solution}

